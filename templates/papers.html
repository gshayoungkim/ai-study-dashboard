{% extends "base.html" %}
{% block title %}ë…¼ë¬¸ ê²Œì‹œíŒ{% endblock %}
{% block content %}
<div class="papers-page">
    <div class="page-header">
        <h1>ğŸ“„ ìš°ë¦¬ê°€ ê´€ì‹¬ìˆëŠ” ë…¼ë¬¸</h1>
        <button onclick="openModal()" class="btn-write">âœï¸ ê¸€ì“°ê¸°</button>
    </div>
    
    <!-- ë…¼ë¬¸ ëª©ë¡ -->
    <div class="papers-container">
        <div id="papers-list" class="papers-list">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>
    </div>
</div>

<!-- ê¸€ì“°ê¸° ëª¨ë‹¬ -->
<div id="writeModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>ë…¼ë¬¸ ê³µìœ í•˜ê¸°</h2>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <form id="paper-form">
            <div class="form-group">
                <label for="title">ì œëª© *</label>
                <input type="text" id="title" name="title" required placeholder="ë…¼ë¬¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            
            <div class="form-group">
                <label for="author">ì‘ì„±ì *</label>
                <input type="text" id="author" name="author" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            
            <div class="form-group">
                <label for="content">ë‚´ìš©</label>
                <textarea id="content" name="content" rows="5" placeholder="ë…¼ë¬¸ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            
            <div class="form-group">
                <label for="link">URL</label>
                <input type="url" id="link" name="link" placeholder="https://arxiv.org/abs/...">
            </div>
            
            <div class="form-buttons">
                <button type="submit" class="btn-submit">ğŸ“¤ ì—…ë¡œë“œ</button>
                <button type="button" class="btn-cancel" onclick="closeModal()">âŒ ì·¨ì†Œ</button>
            </div>
        </form>
    </div>
</div>

<style>
.papers-page {
    padding: 2rem;
    background: #f5f5f5;
    min-height: 100vh;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

.page-header h1 {
    margin: 0;
    color: #333;
}

.btn-write {
    padding: 0.8rem 1.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-write:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

/* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
    animation: fadeIn 0.3s;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 0;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    animation: slideDown 0.3s;
}

@keyframes slideDown {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 2px solid #f0f0f0;
}

.modal-header h2 {
    margin: 0;
    color: #667eea;
}

.close {
    font-size: 2rem;
    font-weight: bold;
    color: #999;
    cursor: pointer;
    transition: color 0.3s;
}

.close:hover {
    color: #333;
}

#paper-form {
    padding: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: #333;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 0.8rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #667eea;
}

.form-buttons {
    display: flex;
    gap: 1rem;
}

.btn-submit,
.btn-cancel {
    flex: 1;
    padding: 1rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-submit {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.btn-cancel {
    background: #f44336;
    color: white;
}

.btn-cancel:hover {
    background: #d32f2f;
}

.papers-container {
    max-width: 1200px;
    margin: 0 auto;
}

.papers-list {
    display: grid;
    gap: 1.5rem;
}

.paper-card {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.3s;
    cursor: pointer;
}

.paper-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
}

.paper-header {
    margin-bottom: 1rem;
}

.paper-title {
    font-size: 1.3rem;
    font-weight: bold;
    color: #333;
    margin: 0 0 0.5rem 0;
}

.paper-author {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.paper-date {
    color: #999;
    font-size: 0.9rem;
}

.paper-content {
    color: #666;
    line-height: 1.6;
    margin-bottom: 1rem;
}

.paper-link {
    display: inline-block;
    color: #667eea;
    text-decoration: none;
    font-weight: bold;
}

.paper-link:hover {
    text-decoration: underline;
}

.empty-message {
    text-align: center;
    color: #999;
    padding: 3rem;
    font-size: 1.1rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadPapers();
    
    document.getElementById('paper-form').addEventListener('submit', function(e) {
        e.preventDefault();
        submitPaper();
    });
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const modal = document.getElementById('writeModal');
        if (event.target == modal) {
            closeModal();
        }
    }
});

function openModal() {
    document.getElementById('writeModal').style.display = 'block';
    document.body.style.overflow = 'hidden'; // ìŠ¤í¬ë¡¤ ë°©ì§€
}

function closeModal() {
    document.getElementById('writeModal').style.display = 'none';
    document.body.style.overflow = 'auto'; // ìŠ¤í¬ë¡¤ ë³µì›
    resetForm();
}

function loadPapers() {
    fetch('/api/papers')
        .then(res => res.json())
        .then(papers => {
            const listEl = document.getElementById('papers-list');
            
            if (papers.length === 0) {
                listEl.innerHTML = '<div class="empty-message">ì•„ì§ ê³µìœ ëœ ë…¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë…¼ë¬¸ì„ ê³µìœ í•´ë³´ì„¸ìš”!</div>';
                return;
            }
            
            listEl.innerHTML = papers.map(paper => `
                <div class="paper-card" onclick="location.href='/papers/${paper.id}'">
                    <div class="paper-header">
                        <h3 class="paper-title">${escapeHtml(paper.title)}</h3>
                        <div class="paper-author">ğŸ“ ${escapeHtml(paper.author || 'ìµëª…')}</div>
                        <span class="paper-date">${formatDate(paper.created_at)}</span>
                    </div>
                    ${paper.content ? `<p class="paper-content">${escapeHtml(paper.content).substring(0, 150)}${paper.content.length > 150 ? '...' : ''}</p>` : ''}
                    ${paper.link ? `<a href="${escapeHtml(paper.link)}" target="_blank" class="paper-link" onclick="event.stopPropagation()">ğŸ”— ë…¼ë¬¸ ë³´ê¸°</a>` : ''}
                </div>
            `).join('');
        })
        .catch(err => console.error('[ERROR] ë…¼ë¬¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', err));
}

function submitPaper() {
    const title = document.getElementById('title').value;
    const author = document.getElementById('author').value;
    const content = document.getElementById('content').value;
    const link = document.getElementById('link').value;
    
    if (!title || !author) {
        alert('ì œëª©ê³¼ ì‘ì„±ìëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤!');
        return;
    }
    
    fetch('/api/papers', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ title, author, content, link })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert('ë…¼ë¬¸ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            closeModal();
            loadPapers();
        } else {
            alert('ì˜¤ë¥˜: ' + data.error);
        }
    })
    .catch(err => {
        console.error('[ERROR] ë…¼ë¬¸ ë“±ë¡ ì‹¤íŒ¨:', err);
        alert('ë…¼ë¬¸ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    });
}

function resetForm() {
    document.getElementById('paper-form').reset();
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>
{% endblock %}
